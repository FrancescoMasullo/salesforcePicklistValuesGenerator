<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salesforce Picklist XML Generator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #0176d3;
            text-align: center;
            margin-bottom: 30px;
        }
        .section {
            margin-bottom: 30px;
        }
        .section h2 {
            color: #333;
            border-bottom: 2px solid #0176d3;
            padding-bottom: 10px;
        }
        textarea {
            width: 100%;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
        }
        input[type="text"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            margin-bottom: 10px;
        }
        .input-section {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
        }
        .excel-input {
            flex: 2;
        }
        .format-options {
            flex: 1;
            min-width: 200px;
        }
        .input-group {
            display: flex;
            flex-direction: column;
        }
        .mode-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .mode-option {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .field-inputs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        .global-input {
            margin-bottom: 20px;
        }
        label {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }
        button {
            background-color: #0176d3;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #014486;
        }
        .example {
            background-color: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #0176d3;
            margin: 15px 0;
        }
        .output {
            background-color: #f8f9fa;
            border: 2px solid #28a745;
            max-height: 400px;
            overflow-y: auto;
        }
        .copy-btn {
            background-color: #28a745;
        }
        .copy-btn:hover {
            background-color: #218838;
        }
        .download-btn {
            background-color: #6f42c1;
        }
        .download-btn:hover {
            background-color: #5a32a3;
        }
        .instructions {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .hidden {
            display: none;
        }
        .package-info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Salesforce Picklist XML Generator</h1>
        
        <div class="instructions">
            <strong>üìã Instructions:</strong>
            <ol>
                <li>Choose between Custom Field or Global Value Set mode</li>
                <li>Enter the required API names</li>
                <li>Copy your Excel data (API Name and Label columns) and paste in the text area</li>
                <li>Make sure data is tab-separated or comma-separated</li>
                <li>Click "Generate XML" to create your picklist values</li>
                <li>Copy the generated XML and package.xml for deployment</li>
            </ol>
        </div>

        <div class="section">
            <h2>üéØ Select Mode</h2>
            <div class="mode-selector">
                <div class="mode-option">
                    <input type="radio" id="fieldMode" name="mode" value="field" checked>
                    <label for="fieldMode">Custom Field on Object</label>
                </div>
                <div class="mode-option">
                    <input type="radio" id="globalMode" name="mode" value="global">
                    <label for="globalMode">Global Value Set</label>
                </div>
            </div>

            <div id="fieldInputs" class="field-inputs">
                <div class="input-group">
                    <label for="objectName">Object API Name:</label>
                    <input type="text" id="objectName" placeholder="e.g., Product_Plant__c, Account, Opportunity" value="Product_Plant__c">
                </div>
                <div class="input-group">
                    <label for="fieldName">Field API Name:</label>
                    <input type="text" id="fieldName" placeholder="e.g., Material_Group_1__c, Status__c" value="Material_Group_1__c">
                </div>
            </div>

            <div id="globalInputs" class="global-input hidden">
                <div class="input-group">
                    <label for="globalValueSetName">Global Value Set API Name:</label>
                    <input type="text" id="globalValueSetName" placeholder="e.g., Unit_Of_Measure, Status_Values">
                </div>
                <div class="input-group">
                    <label for="masterLabel">Master Label:</label>
                    <input type="text" id="masterLabel" placeholder="e.g., Unit Of Measure, Status Values">
                </div>
            </div>
        </div>

        <div class="section">
            <h2>üìä Input Your Excel Data</h2>
            <div class="example">
                <strong>Example format:</strong><br>
                API_NAME_1&nbsp;&nbsp;&nbsp;&nbsp;Display Label 1<br>
                API_NAME_2&nbsp;&nbsp;&nbsp;&nbsp;Display Label 2<br>
                <em>or comma-separated: API_NAME_1,Display Label 1</em>
            </div>
            
            <div class="input-section">
                <div class="input-group excel-input">
                    <label for="excelData">Paste your Excel data here:</label>
                    <textarea id="excelData" rows="10" placeholder="Paste your data here...&#10;Example:&#10;STEEL_001    Steel Components&#10;PLASTIC_002    Plastic Materials&#10;ALUMINUM_003    Aluminum Parts"></textarea>
                </div>
                <div class="input-group format-options">
                    <label>Data Format:</label>
                    <div style="margin-bottom: 10px;">
                        <input type="radio" id="tab" name="separator" value="tab" checked>
                        <label for="tab">Tab-separated</label>
                    </div>
                    <div>
                        <input type="radio" id="comma" name="separator" value="comma">
                        <label for="comma">Comma-separated</label>
                    </div>
                </div>
            </div>
            
            <button onclick="generateXML()">üîÑ Generate XML</button>
            <button onclick="clearData()">üóëÔ∏è Clear</button>
            <button class="download-btn" onclick="downloadDeploymentZip()" id="downloadBtn" style="display: none;">üì¶ Download Deployment ZIP</button>
        </div>

        <div class="section">
            <h2>üìù Generated XML Values</h2>
            <textarea id="output" class="output" rows="15" readonly placeholder="Generated XML will appear here..."></textarea>
            <button class="copy-btn" onclick="copyToClipboard()">üìã Copy to Clipboard</button>
        </div>

        <div class="section">
            <h2>üìã Complete XML Structure</h2>
            <p>Here's your complete XML that you can use in your deployment:</p>
            <textarea id="completeXML" class="output" rows="20" readonly placeholder="Complete XML structure will appear here..."></textarea>
            <button class="copy-btn" onclick="copyCompleteXML()">üìã Copy Complete XML</button>
        </div>

        <div class="section">
            <h2>üì¶ Package.xml for Deployment</h2>
            <div class="package-info">
                <strong>üí° Deployment Instructions:</strong>
                <p id="deploymentInstructions">Choose a mode and generate XML to see deployment instructions.</p>
            </div>
            <textarea id="packageXML" class="output" rows="8" readonly placeholder="Package.xml will appear here..."></textarea>
            <button class="copy-btn" onclick="copyPackageXML()">üìã Copy Package.xml</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script>
        // Verifica che JSZip sia caricato
        function checkJSZip() {
            if (typeof JSZip === 'undefined') {
                console.error('JSZip not loaded');
                return false;
            }
            return true;
        }
        // Mode switching
        document.querySelectorAll('input[name="mode"]').forEach(radio => {
            radio.addEventListener('change', function() {
                const fieldInputs = document.getElementById('fieldInputs');
                const globalInputs = document.getElementById('globalInputs');
                
                if (this.value === 'field') {
                    fieldInputs.classList.remove('hidden');
                    globalInputs.classList.add('hidden');
                } else {
                    fieldInputs.classList.add('hidden');
                    globalInputs.classList.remove('hidden');
                }
                
                // Clear outputs when switching modes
                clearOutputs();
            });
        });

        function generateXML() {
            const data = document.getElementById('excelData').value.trim();
            const separator = document.querySelector('input[name="separator"]:checked').value;
            const mode = document.querySelector('input[name="mode"]:checked').value;
            
            if (!data) {
                alert('Please paste your Excel data first!');
                return;
            }

            const lines = data.split('\n').filter(line => line.trim());
            const sep = separator === 'tab' ? '\t' : ',';
            
            if (mode === 'field') {
                generateFieldXML(lines, sep);
            } else {
                generateGlobalValueSetXML(lines, sep);
            }
        }

        function generateFieldXML(lines, sep) {
            const objectName = document.getElementById('objectName').value.trim();
            const fieldName = document.getElementById('fieldName').value.trim();
            
            if (!objectName || !fieldName) {
                alert('Please enter both Object and Field API names!');
                return;
            }

            let xmlValues = '';

            lines.forEach(line => {
                const parts = line.split(sep);
                if (parts.length >= 2) {
                    const apiName = parts[0].trim();
                    const label = parts[1].trim();
                    
                    xmlValues += `                <value>
                    <fullName>${apiName}</fullName>
                    <default>false</default>
                    <label>${label}</label>
                </value>\n`;
                }
            });

            // Generate complete XML structure
            const completeXML = `<?xml version="1.0" encoding="UTF-8"?>
<CustomObject xmlns="http://soap.sforce.com/2006/04/metadata">
    <fields>
        <fullName>${fieldName}</fullName>
        <externalId>false</externalId>
        <label>${fieldName.replace(/__c$/, '').replace(/_/g, ' ')}</label>
        <required>false</required>
        <trackTrending>false</trackTrending>
        <type>Picklist</type>
        <valueSet>
            <valueSetDefinition>
                <sorted>false</sorted>
${xmlValues}            </valueSetDefinition>
        </valueSet>
    </fields>
</CustomObject>`;

            // Generate package.xml
            const packageXML = `<?xml version="1.0" encoding="UTF-8"?>
<Package xmlns="http://soap.sforce.com/2006/04/metadata">
    <types>
        <members>${objectName}</members>
        <name>CustomObject</name>
    </types>
    <version>58.0</version>
</Package>`;

            document.getElementById('output').value = xmlValues;
            document.getElementById('completeXML').value = completeXML;
            document.getElementById('packageXML').value = packageXML;
            
            document.getElementById('deploymentInstructions').innerHTML = `
                <strong>For Custom Field Deployment:</strong><br>
                1. Save the Complete XML as <code>objects/${objectName}.object</code><br>
                2. Save the Package.xml as <code>package.xml</code><br>
                3. Create a ZIP with both files and deploy via Workbench<br>
                4. Or click the "Download Deployment ZIP" button below!
            `;
            
            // Show download button
            document.getElementById('downloadBtn').style.display = 'inline-block';
        }

        function generateGlobalValueSetXML(lines, sep) {
            const globalValueSetName = document.getElementById('globalValueSetName').value.trim();
            const masterLabel = document.getElementById('masterLabel').value.trim();
            
            if (!globalValueSetName || !masterLabel) {
                alert('Please enter both Global Value Set API Name and Master Label!');
                return;
            }

            let xmlValues = '';

            lines.forEach(line => {
                const parts = line.split(sep);
                if (parts.length >= 2) {
                    const apiName = parts[0].trim();
                    const label = parts[1].trim();
                    
                    xmlValues += `    <customValue>
        <fullName>${apiName}</fullName>
        <default>false</default>
        <label>${label}</label>
    </customValue>\n`;
                }
            });

            // Generate complete XML structure
            const completeXML = `<?xml version="1.0" encoding="UTF-8"?>
<GlobalValueSet xmlns="http://soap.sforce.com/2006/04/metadata">
${xmlValues}    <masterLabel>${masterLabel}</masterLabel>
    <sorted>false</sorted>
</GlobalValueSet>`;

            // Generate package.xml
            const packageXML = `<?xml version="1.0" encoding="UTF-8"?>
<Package xmlns="http://soap.sforce.com/2006/04/metadata">
    <types>
        <members>${globalValueSetName}</members>
        <name>GlobalValueSet</name>
    </types>
    <version>58.0</version>
</Package>`;

            document.getElementById('output').value = xmlValues;
            document.getElementById('completeXML').value = completeXML;
            document.getElementById('packageXML').value = packageXML;
            
            document.getElementById('deploymentInstructions').innerHTML = `
                <strong>For Global Value Set Deployment:</strong><br>
                1. Save the Complete XML as <code>globalValueSets/${globalValueSetName}.globalValueSet</code><br>
                2. Save the Package.xml as <code>package.xml</code><br>
                3. Create a ZIP with both files and deploy via Workbench<br>
                4. Or click the "Download Deployment ZIP" button below!
            `;
            
            // Show download button
            document.getElementById('downloadBtn').style.display = 'inline-block';
        }

        function clearData() {
            document.getElementById('excelData').value = '';
            clearOutputs();
        }

        function clearOutputs() {
            document.getElementById('output').value = '';
            document.getElementById('completeXML').value = '';
            document.getElementById('packageXML').value = '';
            document.getElementById('deploymentInstructions').innerHTML = 'Choose a mode and generate XML to see deployment instructions.';
            document.getElementById('downloadBtn').style.display = 'none';
        }

        function copyToClipboard() {
            const output = document.getElementById('output');
            output.select();
            document.execCommand('copy');
            alert('XML values copied to clipboard!');
        }

        function copyCompleteXML() {
            const completeXML = document.getElementById('completeXML');
            completeXML.select();
            document.execCommand('copy');
            alert('Complete XML copied to clipboard!');
        }

        function copyPackageXML() {
            const packageXML = document.getElementById('packageXML');
            packageXML.select();
            document.execCommand('copy');
            alert('Package.xml copied to clipboard!');
        }

        function downloadDeploymentZip() {
            const mode = document.querySelector('input[name="mode"]:checked').value;
            const completeXML = document.getElementById('completeXML').value;
            const packageXML = document.getElementById('packageXML').value;
            
            if (!completeXML || !packageXML) {
                alert('Please generate XML first!');
                return;
            }

            // Verifica che JSZip sia disponibile
            if (!checkJSZip()) {
                alert('ZIP library not loaded. Please copy the files manually.');
                return;
            }

            try {
                // Create JSZip instance
                const zip = new JSZip();
                
                // Add package.xml to root
                zip.file('package.xml', packageXML);
                
                let zipFileName = '';
                
                if (mode === 'field') {
                    const objectName = document.getElementById('objectName').value.trim();
                    const fieldName = document.getElementById('fieldName').value.trim();
                    
                    // Create objects folder and add the object file
                    zip.folder('objects');
                    zip.file(`objects/${objectName}.object`, completeXML);
                    
                    zipFileName = `${objectName}_${fieldName}_deployment.zip`;
                } else {
                    const globalValueSetName = document.getElementById('globalValueSetName').value.trim();
                    
                    // Create globalValueSets folder and add the file
                    zip.folder('globalValueSets');
                    zip.file(`globalValueSets/${globalValueSetName}.globalValueSet`, completeXML);
                    
                    zipFileName = `${globalValueSetName}_deployment.zip`;
                }
                
                // Generate and download the ZIP file
                zip.generateAsync({type: 'blob'})
                    .then(function(content) {
                        const link = document.createElement('a');
                        link.href = URL.createObjectURL(content);
                        link.download = zipFileName;
                        document.body.appendChild(link);
                        link.click();
                        document.body.removeChild(link);
                        
                        // Cleanup
                        setTimeout(() => {
                            URL.revokeObjectURL(link.href);
                        }, 100);
                    })
                    .catch(function(error) {
                        console.error('Error generating ZIP:', error);
                        alert('Error creating ZIP file. Please copy the XML files manually.');
                    });
            } catch (error) {
                console.error('Error in downloadDeploymentZip:', error);
                alert('Error creating ZIP file. Please copy the XML files manually.');
            }
        }

        // Auto-detect separator based on input
        document.getElementById('excelData').addEventListener('paste', function(e) {
            setTimeout(() => {
                const data = this.value;
                const tabCount = (data.match(/\t/g) || []).length;
                const commaCount = (data.match(/,/g) || []).length;
                
                if (tabCount > commaCount) {
                    document.getElementById('tab').checked = true;
                } else if (commaCount > tabCount) {
                    document.getElementById('comma').checked = true;
                }
            }, 100);
        });
    </script>
</body>
</html>